<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" type="text/css" href="resources/style.css">
    <script src="resources/jquery.js"></script>
    <script src="resources/data_generator.js"></script>
    <script src="resources/settingslog"></script>
  </head>
  <body>
    <header>
      <div class="herald">
        <h1>Welcome to Twiddler!</h1>
        <h2>... for all your twiddling needs</h2>
      </div>
    </header>
    <div class="main">
      <aside class="nav-bar">
        <div class=profile>
          <p> Log in </p>
          <input></input>
        </div>
        <a class="button home">Home</a>
        <a class="button refresh">Refresh Feed</a>
        <a class="button settings">Settings</a>
      </aside>
      <div class="twidconsole">
        <div class="tweetentry">
          <a class="button user">You are not logged in</a>
        </div>
        <div class="twidfeed">
        </div>
      </div>
    </div>
    <footer>
      <h6>&copy; Frias Productions LLC 2018</h6>
    </footer>
    <script>

      let $twidConsole = $('div.twidconsole'),
          $home = $('a.button.home'),
          $refresh = $('a.button.refresh'),
          $settings = $('a.button.settings'),
          viewPage = 'home',
          viewUser = null;
          loggedIn = false;

      $home.click(function(){
        update('home', null);
      });

      $refresh.click(function(){
        update();
      });
      
      $(function() {
        $(document).on('click', '.user', function(){
          $this = $(this);
          var handle = $this.text().slice(1, Infinity);
          update('users', handle)
        });
       });

      const update = (feed=viewPage, user=viewUser) => {

        $("div.twidconsole .twidfeed").html('');
//        if (feed === 'home') {
//          $(".twidentry").setAttribute("display", "none");
//        } else if (feed === 'users') {
//          $(".twidentry").setAttribute("display", "inherit");
//        };

        viewPage = feed;
        viewUser = user;

        var index = (viewUser === null) ? streams[viewPage].length - 1 : streams[viewPage][viewUser].length - 1;
        while(index >= 0){
          var tweet = (viewUser === null) ? streams[viewPage][index] : streams[viewPage][viewUser][index];
          var $tweet = $('<section></section>');
          $('<a class="button user">@' + tweet.user + '</a>').appendTo($tweet);
          $('<p>' + tweet.message + '</p>').appendTo($tweet);
          $('<time>Sent ' + (Math.floor((Date.now() - tweet.created_at) / 1000)) + ' seconds ago</time>').appendTo($tweet);
          $tweet.appendTo("div.twidconsole .twidfeed");
          index -= 1;
        }
      };

      $(document).ready(update('home', null));

    </script>
  </body>
</html>
